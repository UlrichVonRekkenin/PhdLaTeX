\chapter{Описание АСУ ТП для СК}\label{ch:chn}

% https://m.studref.com/495961/ekonomika/klassifikatsiya_imitatsionnyh_modeley_promyshlennogo_predpriyatiya

Автоматизированная система управления технологическим процессом (АСУ~ТП) --- это термин,
имеющий отношение к ЭВМ, обеспечивающим управление различными техническими процессами \cite{journal:iter_research_guriev_2016}.
Изначально системы АСУ~ТП использовались исключительно на производстве, но с развитием технологий
и из-за сходства технических процессов АСУ~ТП вышло за рамки управления сугубо производственными процессами
и перешла в другие сферы деятельности, от управления транспортом %\cite{}
до управления техническими процессами зданий \cite{journal:vechisl_tech:2013:Golushko}
и более сложными техническими сооружениями (например, здесь \cite{journal:vechisl_tech:2004_okolnischnikov}).
%
Далее будет показано создание \todo{аналитической} модели объекта контроля
при создании имитатора объекта контроля и его применение на всех этапах жизненного цикла
объекта контроля: от постановки задачи и проектирования системы контроля, до пусконаладочных работ
и сдачи в опытную эксплуатацию.

\section*{Введение}


Стоит отметить, что для более качественной/глубокой имитации необходимо выделять несколько моделей
(которые по факту являются подмоделями, но так как они могут выступать в качестве самостоятельных единиц исследования,
далее будем называть их моделями),
анализируя данные этих моделей (экспериментально) установить свойства этих моделей:
стационарность, детерминированность и проч.

В модели объекта контроля может быть несколько моделей \cite{journal:vechisl_tech:2004_okolnischnikov}:
\begin{itemize}
    \item модель технологического объекта управления (правила перехода);
    \item модель имитации внешних сигналов;
    \item модель внутреннего состояния объекта контроля (токи, напряжения и т.д. и т.п.);
    \item \ldots
\end{itemize}

% Для пояснения смотри рисунок \ref{fig:submodels_asu_tp} и раздел \ref{sec:submodels_asutp}.
% \begin{center}
%     \begin{figure}[hb]
%         % \includegraphics[width=.8\textwidth]{submodels_asu_tp}
%         \caption{\todo{Здесь будут подмодели...}. Структура модели}\label{fig:submodels_asu_tp}
%     \end{figure}
% \end{center}

Поскольку построение чисто аналитической модели имеет недостаток  в виде отсутствия возможности
описать поведение исследуемого объекта во времени, используется имитационная модель.

\textit{Имитационное моделирование} --- процесс построения некоего алгоритма, который имитирует
поведение исследуемого объекта и взаимодействие исходного объекта с учетом возможных случайных входных величин и
воздействий из внешней среды \cite{book:vvedeni_imit_model_1987}.

Объекты контроля, такие как необитаемые автономные подводные аппараты \todo{\ldots},
на которые в любой момент времени возлагается функция готовности к  работе,
нуждаются в проведении проверок при эксплуатации и хранении.
%
Для проверки ОК необходима система контроля. Создание и отладка СК сопряжена со следующими факторами.
%
\begin{itemize}
    \item Дороговизна и труднодоступность достаточного количества статистического материала
    натурных испытаний для отладки алгоритмов ПО СК экономически нецелесообразна, так же связана с риском для жизни испытующих.
    %
    \item ОК находится на этапе проектирования.
    %
    \item Отсутствует возможность подключения к ОК.
    %
    \item Проверка граничных значений алгоритмов ОК, ведущих к разрушению ОК недопустима.
\end{itemize}



\section{Направление информационных потоков} %\label{ch:ch2}

Структурная схема системы контроля показана на рисунке \ref{fig:asc_schema}.
Взаимодействие между каждыми узлами опосредованно, то есть
оператор (диспетчер) взаимодействует с автоматизированным рабочим местом (АРМ),
физическая реализация которого это ЭВМ со специализированным программным обеспечением.
Оператор, выбирая один из режимов работы, сообщает посредством АРМ,
какой набор выходных параметров должна сформировать СК, чтобы объект контроля вышел на заданный режим проверки.
Штрих пунктиром показано взаимодействие оператора с объектом контроля,
которое подразумевает механическое задействование органов управления ОК
или, некий, например, аудио-визуальный контроль состояния узлов ОК.

\begin{center}
    \begin{figure}[hb]
        \includegraphics[width=.8\textwidth]{scheme.png}
        \caption{Структура программно-технологического комплекса системы контроля}\label{fig:asc_schema}
    \end{figure}
\end{center}

Более детальное описание информационных потоков показано на рисунке \ref{fig:asc_info_bus}.
Выделяется три уровня: нижний, средний и верхний.

На нижнем уровне располагаются подключаемые по промышленным каналам связи различные приборы, датчики и агрегаты,
которые непосредственно двунаправленно взаимодействуют с ОК, посылая и принимая от него сигналы.
% Так же на этом уровне располагаются прочие устройства, обеспечивающие непосредственное ...

Средний уровень отвечает за обмен информацией между нижним и верхним уровнями. Этот уровень, как правило,
состоит из программируемого логического контроллера (ПЛК). ПЛК реализует различные алгоритмы управления,
осуществляется формирование, сортировка, масштабирование и подготовка данных для передачи между уровнями.
В частности, это может быть осуществлено с помощью блока гальванической развязки (БГР).

Верхний уровень отвечает за графическое представление данных (в широком смысле этого слова),
обеспечивает диспетчеризацию и сбор подготовленных данных посредством человеко-машинного интерфейса.

\begin{center}
    \begin{figure}[hb]
        \includegraphics[width=.8\textwidth]{scheme_3levels.png}
        \caption{Информационные шины системы контроля}\label{fig:asc_info_bus}
    \end{figure}
\end{center}

На рисунке \ref{fig:asc_info_bus} штрихом выдела область данных, которая \textit{может быть}
представлена (заменена) имитационное моделью.

Стоит отметить, что в некоторой литературе средний и нижний уровни объединены в один нижний уровень.



\section{Составные части имитационной модели. Контролируемые параметры} \label{sec:submodels_asutp}

Далее обсудим более подробно обмен информацией по промышленному протоколу Modbus.

\subsection{Аналоговые и дискретный стимулы реакции} \label{sect:stimulus_reactions_def}

Множества аналоговых и дискретных реакций
$A^r_{out} = \{a^{r,i}_{out}, i = 1 \dots N^{r,a}_{out}\}$,
$D^r_{out} = \{d^{r,i}_{out}, i = 1 \dots N^{r,d}_{out}\}$,
а так же множества аналоговых и дискретных стимулов
$A^s_{out} = \{a^{s,i}_{out}, i = 1 \dots N^{s,a}_{out}\}$,
$D^s_{out} = \{d^{s,i}_{out}, i = 1 \dots N^{s,d}_{out}\}$
образуют множество параметров $\mathcal{M} = \{A^r_{out}, D^r_{out}, A^s_{out}, D^s_{out}\}$,
передаваемых по сети Modbus. С помощью параметров $m_i \in M$ осуществляется контроль таких параметров,
как: ток потребления, напряжения на силовых установках,
текущая глубина хода, срабатывание различных релейных блоков \todo{\ldots}.

Протокол Modbus позволяет использовать сущности клиент (мастер) и сервер (подчиненный узел)
для организации взаимодействия. В данном случае программа ВУ является клиентом, а ПЛК --- сервером.
Таким образом можно произвести программную имитацию серверной части взаимодействия.
Отождествляя множества стимулов и реакций с протоколом Modbus, мы получаем, что
$D^s_{out}$ соответствуют coils, $A^s_{out}$ -- holding registers,
а $A^r_{out}$,  $D^r_{out}$ -- input registers, discrete inputs, соответственно.

Таким образом получаем множество стимулов $\mathcal{S} = \{D^s_{out}, A^s_{out}\}$
и множество реакций $\mathcal{R} = \{D^r_{out}, A^r_{out}\}$,
причём, $\mathcal{M} = \{\mathcal{R}, \mathcal{S}\} = \mathcal{R} + \mathcal{S}$.

Рассмотрим более подробно какие элементы предметной области
\textit{автономного самоходного подводного аппарата с телеуправлением}
представляются стимулами, а какие -- реакциями.

\subsection{Контролируемые параметры АНПА}

\textbf{Потребная мощность ОК и его составных частей.}
Суммарный ток потребления изделия $I_{tot} = \sum_k^{N_{part}} I_k + \hat I$
и токи контролируемых узлов системы $I_k,\, k\in[1..N_{part}]$,
где $\hat I$ --- ток узлов не подлежащих контролю,
являются аналоговыми реакциями $A^r_{out}$.

Пронумеруем их соответствующим образом $A^r_{out,<i>} = A_i$,
где индекс $i$ пробегает по всем значениям токов,
определённых в техническом задание (тактико-технических характеристиках и проч.) на ОК.

Допустимый диапазон изменений определяется из электрической схемы бортовой сети ОК.
Определим эти диапазоны как константные параметры модели ОК $A_i \in [\min_i, \max_i]$
для каждого контролируемого параметра тока.

Выход $\forall A_i \notin [\min_i, \max_i]$ считается аварийным режимом работы ОК.

\textbf{\todo{
    Выдача определенного напряжения и тока должны происходить при выполнении определенных условий,
    например, таких как инициализация некой заданной программы работы, которая
    отождествляется с набором управляющих стимулов и ответных реакций.
    В принципе, достаточно следить за конечным набором параметров и
    имитировать напряжения и токи моментально или с некой задержкой.
}}

\textbf{Контроль глубины хода изделия.}
Изделие должно следовать на заданной глубине, обусловленной внутренними алгоритмами объекта контроля.
Контроль глубины осуществляется с помощью гидравлической системы,
показания с которой считываются с аналогового датчика глубины (токовый сигнал проходит через БГР).

В общем случае гидравлическая система управляется системой контроля,
по заранее определенному алгоритму, соответствующему выбранному режиму проверки\footnote{Система с обратной связью.}.

\textbf{\todo{
    Таким образом имитация глубины хода ОК производится по заданному сценарию
    после выполнения условий, например, наличие тока потребления
    и на произвольный набор моментов времени $\{t_1, t_2, \ldots, t_n\}$
    происходит изменение глубины $\{h_1, h_2, \ldots, h_n\}$, соответственно.
}}


\textbf{Имитация вращения вала винтов. Пройденная дистанция}
Согласно выбранной программе на ПЛК вырабатывается соответствующая 
частота вращения вала $f_n$ в виде ШИМ сигнала.
Из изделия возвращается сигнал о прохождении определенной дистанции (метка кратного прохождения $m$ метров),
система контроля анализирует интервал времени между передними фронтами меток
и сигнализирует о корректном или некорректном периоде сигналов.
\textbf{\todo{
    Таким образом имитация вращения валов винтов производится выработкой
    прямоугольного сигнала с заданным периодом и скважностью.
}}

Располагая информацией о поступи изделия возможно пересчитать метки $m$ в пройденную дистанцию.
\textbf{\todo{
    Таким образом необходимо иметь возможность генерировать
    сообщения с заданными периодичностью и величиной измениня вещественной переменной
    (в общем случае как на отрицательную, так и на положительную величину).
}}


\textbf{Проводная линия связи.}
Управляющая последовательность битов $b_{in}$, физически представляющая напряжение $|U_{\longrightarrow}|$,
которая имеет следующий вид:
\begin{itemize}
	\item первый бит имеет длительность $\tau^s = s \tau$ с отрицательной полярностью запускающего импульса (ЗИ);
	\item последующие $n$ бит имеют длительность $\tau$
\end{itemize}

\begin{equation} \label{eq:pls_request}
    W_{\longrightarrow} = 
    \overbrace{\mbox{ЗИ}}^{\tau^s}
    \underbrace{000`000`...`00 \overbrace{0}^{\tau}}_{\mbox{$n$ бит}} \,.
\end{equation}

При отрицательной полярности ЗИ, следующий за ним бит имеет противоположную (положительную) полярность.
ЗИ и последовательность бит не имеют пауз между собой.
Отсутствие сигнала между битами более $\delta$ расценивается изделием как логический ноль.

Ответная последовательность бит имеет следующий вид, напряжение ответных сигналов
$|U_{\longleftarrow}| < |U_{\longrightarrow}|$:

\begin{equation} \label{eq:pls_reply}
    W_{\longleftarrow} = 
    \overbrace{\mbox{СИ1}}^{\tau^s}
    \underbrace{000...000}_{\rotatebox{90}{\mbox{Задача}}}
    \overbrace{\mbox{СИ2}}^{\tau^s} \underbrace{000...000}_{\rotatebox{90}{\mbox{Скорость/Курс}}}
    \overbrace{\mbox{СИ3}}^{\tau^s}
    \underbrace{000...000 \overbrace{0}^{\tau}}_{\rotatebox{90}{\mbox{Статус}}}
\end{equation}

СК анализирует наличие трёх синхроимпульсов (СИ), при отсутствии хотя бы одного ответ считается невалидным.
При поступлении трёх невалидных ответов подряд обмен по ПЛС прекращается. 

При проверке анализируется токовый сигнал, при $I_{\mbox{ТУ}\longleftarrow} \geq I_{min}$ бит считается равным логической единице.

Цикл команд (\ref{eq:pls_request}) ответов (\ref{eq:pls_reply}) продолжается до конца выполнения выбранной задачи,
или до досрочной остановки
или до программной имитации обрыва линии связи.

Невыполнение заданной команды управления по ПЛС в течении 
заданного времени $t = k \cdot T$, где
$k$ --- предельно допустимое число сбойных циклов обмена,
$T$ --- длительность полного цикла обмена, считается сбоем работы 
подсистемы ПЛС ОК, при этом ОК должен перейти в автономный режим работы. Контроль продолжается до окончания заложенной программы.

Очевидно, что как ответные последовательности так и управляющие последовательности бит
могут быть преобразованы в многобайтовые слова, которами обменивается ВУ и НУ программного обеспечения СК.
Сериализация и десериализация последовательности бит остается за рамками этой работы,
интерес же представляет обмен непосредственно многобайтовыми словами $W_{\longrightarrow}\,,W_{\longleftarrow}$.

\textbf{\todo{
    Выдача определенного слова должна происходить при выполнении
    конечного множества условий как с задержкой, так и без нее.
}}

\section*{Выводы}

Имитация обмена информацией ПО СК с объектом контроля осуществляется с помощью следующих компонентов:
\begin{itemize}
    \item непосредственная запись значения при выполнении единичного условия;
    \item отложенная запись значения при выполнении единичного условия;
    \item непосредственная запись значения при выполнении множественных условий;
    \item отложенная запись значения при выполнении множественных условий;
    \item периодическое изменение на заданную величину в течении определенного времени.
\end{itemize}
Далее будет показана модель \textit{решающая} эту задачу.

\input{Dissertation/cim.tex}
