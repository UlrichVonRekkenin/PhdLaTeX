@startuml
!include style.iuml

actor Оператор as user
entity "parser" as parser
box "manager" #F0FFF0
    entity "ModbusIoManager" as manager
    collections "Компоненты\nIModbusElementWriter" as components
    entity IDeviceWriter as device
end box
participant "Шина данных\nпо протоколу\nModbus" as modbus

create parser
user -> parser : Чтение\nсценария
activate parser #FFBBBB
activate manager #FFBBFB
activate device

parser -> manager : Устновка\nкомпонентов
create components
manager -> components : **manager.setCaptures(parser.capures())**
note over components #FAFADA : Компоненты подписываются\nна события шины данных
destroy parser
activate components

modbus <--] : Новые\nданные
note over modbus #DADADD : Игнорируются\nпри выключенном\n**manager**

user -> manager : Активация компонентов,\nподписывание на события шины
note over manager #FAFADA : manager.startAll()

loop Обработка данных
    modbus <--] : Новые\nданные
    note over modbus : Изменение данных\nпрограммой\nверхнего уровня
    autonumber
    modbus -> manager : [slot] **newModbudData()**
    note over manager : Менеджер делегирует\nработу компоненту
    manager -> components : [slot] **newModbudData()**
    alt Условия выполняются
        activate components #FFBBFB
        note over components : а) Компонент запущен?\nб) Изменение этого параметра отслеживается?\nв) Изменения удовлетворяют ожидаемым значениям?
       
        components -> device : **write()**
        activate device
        note over components : Делегация записи устройству
        device ->] : [signal] **writed()**
        deactivate device
        note over device #DADADD : Кто угодно во внешнем\nмире может быть подписан\nна события **manager**
       
        components -> components : **reset()**
        activate components
        deactivate components
        note over components : Компонент отписывается\nот событий по шине данных
        deactivate components

    else Условия не выполняются
        note over manager,components #DADADD : Игнорируется это сообщение
    end
    autonumber stop
end

user -> manager : Завершение работы
note over manager #FAFADA : **manager.resetAll()**
destroy manager
destroy components
destroy device

@enduml