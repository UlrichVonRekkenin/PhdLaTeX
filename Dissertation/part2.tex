\chapter{Модель АНПА}\label{sec:part2}
В данном разделе проводится анализ модели АНПА на предмет наличия составных частей
и их взаимоотношений на предметном и информационном уровнях взаимодействия и взаимовлияния.

\section{Описание модели АНПА} \label{sec:model_anpa}

Исследуемый объект контроля представляет собой АНПА, предназначенный для поиска скоплений планктона,
рыбных косяков или китов под водой путем испускания специализированной зондирующей посылки и ее анализа.
АНПА заключен в металлический корпус, внутри которого располагаются составные части.
В данной модели предполагается, что прибор управления является центральным управляющим узлом изделия,
на который возложены все функции принятия решений.

Для проверки объекта контроля АНПА необходима система контроля (например, как на рисунках~\ref{fig:ask_obj_operator}, \ref{fig:ask_obj_operator_3}).
Создание и отладка системы контроля сопряжена со следующими факторами.
\begin{enumerate}
    \item объект контроля находится на этапе проектирования.
    \item Дороговизна и труднодоступность достаточного количества статистического материала
    натурных испытаний для отладки алгоритмов ПО системы контроля экономически нецелесообразна.
    \item Отсутствует возможность непосредственного подключения к объекту контроля.
    \item Проверка граничных значений алгоритмов объекта контроля, ведущих к его разрушению недопустима.
    \item Часть проверок связана с риском для жизни испытующих.
\end{enumerate}
\begin{center}
    \begin{figure}[hb!]
        \includegraphics[width=.88\textwidth,keepaspectratio]{scheme.png}
        \caption[Взаимодействие СК и ОК]
            {Механизмы взаимодействия СК и ОК с участием оператора.}
                \label{fig:ask_obj_operator}
        %
        \includegraphics[width=.88\textwidth,keepaspectratio]{scheme_3levels.png}
        \caption[Взаимодействие СК и ОК]
            {Трехуровневая модель системы контроля и ее взаимодействие с объектом контроля.}
                \label{fig:ask_obj_operator_3}
    \end{figure}
\end{center}
На этапах создания и отладки ПО СК необходимо иметь возможность проверки
функционирования алгоритмов проверки без прямого подключения к ОК.
Этого можно достичь путем создания имитатора АНПА ОК на базе ПЛК и системы аналогово-дискретных
модулей ввода-вывода.
В текущих проектах стоимость подобного набора начинается от 500~тысяч рублей,
при этом следующие риски присущи этому подходу:
\begin{itemize}
    \item увеличение накладных расходов (добавочная стоимость);
    \item увеличение сроков разработки, так как невозможно провести проверки в полном объеме до 
        создания, сборки и отладки имитатора на базе ПЛК;
    \item риски, связанные со сроками поставки комплектующих имитатора на базе ПЛК.
\end{itemize}
Выбирая этот подход, возникает следующая проблема.
При начале работы над новым проектом использовать уже имеющиеся комплектующие для создания другого имитатора на базе ПЛК или же заказать новые.

При выборе первого сценария возможны следующие осложнения:
\begin{enumerate*}[label=\arabic*\upshape)]
    \item придется частично или полностью разобрать имеющийся имитатор, тем самым при возникновении 
        осложнений с предыдущим ОК придется заново собирать его;
    \item использовать систему тумблеров для коммутации электрических сигналов,
        увеличивая сложность аппаратной составляющей имитатора на базе ПЛК;
    \item использовать программные средства (if-else ветвления), что увеличит сложность программы имитатора;
    \item так же нельзя исключать пресловутый человеческий фактор.
\end{enumerate*}

Ввиду выше изложенных проблем в настоящей работе предлагается способ их решения,
путем создания онтологии предметной области АНПА;
выделение метаклассов, описывающих взаимодействия сущностей
и на этой основе разработка специализированного программного обеспечения
имитатора объекта контроля. Для этого необходимо произвести \textit{декомпозицию} модели предметной области.


\clearpage
\subsection{Декомпозиция информационной модели АНПА} \label{sec:anpa_decompose}

Тем не менее, прежде чем приступать к разработке ПО системы контроля необходимо провести когнитивный процесс -- \textit{декомпозиция} СЧ АНПА.
Этот процесс состоит в разделения моделируемого АНПА на отдельные элементы, которые станут базовыми единицами информационной модели --- \textbf{объектами} \cite{journal:vestnik_igeu:elizarova}.
Составные части рассматриваемой модели АНПА показаны на~рисунке \ref{fig:model_anpa} и в~таблице \ref{tbl:model_anpa_decompose} в разделе \textbf{объекты}.

В приведенном примере мы обошлись всего лишь несколькими объектами и небольшой глубиной детализации;
однако ее можно развить, выделив в качестве отдельных объектов, например, электрические соединители и проводники
или же выделить корпус АНПА, снабдив их соответствующими качествами.
В общем случае, состав субъекта процедуры декомпозиции может быть неизвестен.
Также АНПА может обладать свойством нестационарности --- его состав динамически меняется:
\begin{enumerate*}[label=\itshape\alph*\upshape)]
\item  существуют отделяемые модули в процессе работы, тогда, очевидно, появится новый объект;
\item используется химическое топливо, масса которого уменьшается в процессе работы,
   но АНПА не перестанет существовать после выработки всей топливной массы.
\end{enumerate*}
Физическая неразрывность далеко не всегда служит основанием для логического объединения или разделения объектов.
Кроме того, далеко не все объекты являются физически неразрывными или вообще имеют однозначное материальное воплощение.
%
Глубина декомпозиции, определение границ объектов, а так же решение о том, создавать или удалять ли объекты в модели
при существенных изменении их состояния, зависят только от прагматики --- практического назначения модели.
Таким образом, для иллюстрации идей, изложенной в даной работе ограничимся небольшой глубиной детализации модели АНПА,
не теряя общности изложения.

\begin{center}
    \begin{figure}[hb!]
        \includegraphics[width=.9\textwidth,keepaspectratio]{model_anpa}
        \caption[Декомпозиция материальной составляющей]
            {Декомпозиция материальной составляющей АНПА на составные части.}
                \label{fig:model_anpa}
    \end{figure}
\end{center}

Далее следует выделить \textbf{функции--действия} АНПА, которые показаны в таблицах
\ref{tbl:model_anpa_decompose}.

\input{Dissertation/model_anpa_decompose}

Исходя из данных, представленных в таблице \ref{tbl:model_anpa_decompose}
строятся матрицы $A$ и $B$, такие что
взаимосвязь \textbf{объектов} и \textbf{функций} представляется матрицей $A$,
а \textbf{функций} и \textbf{действий} --- матрицей $B$:

\begin{equation}\label{eq:matrix_ab}
    \begin{split}
    A = &\begin{pmatrix}
        0 & 0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & 0 & 1 & 1 & 0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 & 1 \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 0 & 1 & 0 & 0 & 0 & 0 & 0 & 0 \\
        0 & 1 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 0 & 0 & 1 & 0 & 1 \\
        0 & 0 & 0 & 1 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 0 \\
        0 & 0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 & 0 & 0 \\
        1 & 1 & 1 & 1 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 1 & 0 \\
        1 & 1 & 1 & 1 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 1 & 0 \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 1 & 0 \\
        0 & 0 & 0 & 0 & 0 & 1 & 1 & 1 & 1 & 1 & 1 & 0 & 0 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 1 & 0 & 0 & 0 & 0 \\
    \end{pmatrix},{}\\
%
    B = &\begin{pmatrix}
        0 & 0 & 0 & 0 & 0 & 1 \\
        0 & 1 & 0 & 0 & 0 & 0 \\
        0 & 1 & 0 & 0 & 0 & 0 \\
        0 & 0 & 1 & 0 & 0 & 0 \\
        0 & 0 & 1 & 0 & 0 & 0 \\
        0 & 0 & 0 & 1 & 1 & 0 \\
        0 & 0 & 0 & 1 & 1 & 0 \\
        0 & 0 & 0 & 1 & 1 & 0 \\
        0 & 0 & 0 & 1 & 1 & 0 \\
        0 & 0 & 0 & 1 & 1 & 0 \\
        1 & 0 & 0 & 0 & 1 & 0 \\
        1 & 1 & 0 & 0 & 0 & 0 \\
        0 & 1 & 1 & 0 & 0 & 1 \\
        0 & 1 & 0 & 0 & 0 & 1 \\
        0 & 0 & 1 & 0 & 0 & 1 \\
        1 & 0 & 0 & 0 & 1 & 0 \\
    \end{pmatrix}\,.
\end{split}
\end{equation}

Ненулевое значение элемента матрицы $a_{ij}$ означает, что есть соответствие между материальным \textbf{объектом} $i$ и \textbf{функцией} $j$.
Например, $a_{11,\,14} = 1$ означает что объект \textit{рули} имеет функции \textit{изменение курса}.
Аналогично $b_{ij} \ne 0$ обозначает наличие ассоциации между функцией $i$ и действием $j$.
Например, $b_{13,\,3} = 1$ соответствует действию \textit{коррекция глубины} и связана с функцией \textit{изменить скорость движения}.

В результате умножения матриц $A$ и $B$ получаем матрицу $C_1$ размера $(6\times14)$,
которая определяет использование сущностей материальной составляющей предметной области действий, найденных через функции:

\begin{equation}
    C_1 = A \times B = \begin{pmatrix}
        1 & 0 & 0 & 1 & 2 & 0 \\
        1 & 1 & 0 & 1 & 1 & 0 \\
        2 & 1 & 0 & 2 & 3 & 0 \\
        0 & 0 & 0 & 2 & 2 & 0 \\
        2 & 3 & 0 & 0 & 2 & 1 \\
        0 & 0 & 3 & 0 & 0 & 1 \\
        0 & 1 & 1 & 1 & 1 & 1 \\
        0 & 1 & 1 & 1 & 1 & 1 \\
        0 & 0 & 0 & 1 & 1 & 0 \\
        0 & 3 & 3 & 0 & 0 & 3 \\
        0 & 3 & 3 & 0 & 0 & 3 \\
        0 & 1 & 1 & 0 & 0 & 2 \\
        1 & 0 & 0 & 5 & 6 & 0 \\
        2 & 1 & 0 & 0 & 1 & 0 \\
    \end{pmatrix}.
\end{equation}

Если $c_{1ik} = 0$, то сущность с номером $i$ не используется в функции с номером $k$ данной функции,
а если $c_{1ik} \ne 0$, то используется.

Построчное суммирование элементов матрицы $C_1$ получаем матрицу $C_2$, показывающую количественные характеристики
использования сущностей материальной составляющей предметной области в функциях:

\begin{equation*}
    C_2 = \begin{pmatrix}
        \sum_{j=1}^l c_{1\,1j} \\
        \ldots \\
        \sum_{j=1}^l c_{1\,mj} \\
    \end{pmatrix} 
    =
    \left( 4\;\; 4\;\; 8\;\; 4\;\; 8\;\; 4\;\; 5\;\; 5\;\; 2\;\; 9\;\; 9\;\; 4\;\; 12\;\; 4 \right)^T.
\end{equation*}
где $c_{2i}$ количество функций, в которых используется данная сущность.

Делением матрицы $C_2$ на число $l = 6$, равное количеству действий в функциональной модели, получаем матрицу $C_3$,
содержащую относительные коэффициенты использования сущностей в действиях:
\begin{multline}
    C_3 = \left. \frac{C_2}{l} \right|_{l \equiv 6} = \\
        \left( 0.67\;\; 0.67\;\; \textbf{1.33}\;\; 0.67\;\; \textbf{1.33}\;\; 0.67\;\; 0.83\;\; 0.83\;\; 
        0.33\;\; \textbf{1.50}\;\;\textbf{1.50}\;\; 0.67\;\; \textbf{2.00}\;\; 0.67 \right)^T
\end{multline}
Установив пороговое значение $K_{min} = \overline{C_3} = 0.98$ получаем, что общесистемными являются
\textit{блок управления батареей (2.0);
    рулевые машинки, рулевой привод (1.5);
    анализатор приемо-излучательного тракта СПО и установщик курса (1.33)}.

Эти общесистемные объекты должны быть реализованы в имитационной модели в первую очередь.
Проведем более детальное рассмотрение этих объектов и информационных пакетов присущих им.


\subsection{Обоснование типов имитируемых сигналов}\label{sec:model_anpa_params}

\subsubsection{Имитация внешнего окружения}\label{sec:model_anpa:outer_params}
Ко внешним параметрам среды в рассматриваемой модели относится
глубина хода АНПА, эхо-сигнал в ответ на зондирующую посылку,
поступающий на \textit{приемник} и обрабатываемый \textit{анализатором приемо-излучающего тракта} АНПА.

\textbf{Глубина.}
Значение глубины меняется в пределах $h \in [0, h_{max}]$,
где $h_{max}$ -- максимально допустимая глубина погружения АНПА, обусловленная его ТТХ,
а глубина $h = 0$ соответствует надводному положению.
АНПА должен следовать на заданной глубине, определяемой внутренними алгоритмами объекта контроля.
Контроль глубины осуществляется с помощью гидравлической системы,
показания с которой считываются аналоговым датчиком глубины и преобразуются АЦП в цифровой сигнал.
В общем случае гидравлическая система управляется системой контроля,
по заранее определенному алгоритму, соответствующему выбранному режиму проверки.

Таким образом имитация глубины хода АНПА производится по заданному сценарию
при выполнения условий, например, наличие тока потребления
и на произвольный набор моментов времени $\{t_1, t_2, \ldots, t_n\}$
происходит изменение глубины $\{h_1, h_2, \ldots, h_n\}$, соответственно.


\textbf{Эхо-сигнал.}
Предполагается, что ПУ формирует управляющую команду $s_j \in \{s_1, s_2, \ldots, s_k\}$ испускаемого сигнала на внутренней шине данных,
которому ставится в соответствие множество допустимых ответов $s_j \Rightarrow \{r_j\} = \{r_{j1}, r_{j2}, \ldots, r_{jn}\}$.
В процессе имитации работы подменяются ответы
$r_{ji} \in \{r_j\} \cup \{e_j\}$, причем $\{r_j\} \cap \{e_j\} = \emptyset$,
где $\{e_j\}$ -- множество аварийных ответов.


Управляющая последовательность бит $s_j$, физически представляющая цифровой сигнал напряжением $|U_{\longrightarrow}|$.
Ответная последовательность бит $r_j$, напряжением $|U_{\longleftarrow}| < |U_{\longrightarrow}|$:
СК анализирует правильность ответа $r_j$ на воздействие $s_j$,
также анализируется величина тока, при $I_{\longleftarrow} \geq I_{min}$ биты в ответе $r_j$ считаются равными логической единице.
Цикл команд $s_j \Rightarrow r_j$ продолжается до конца выполнения выбранной задачи или до досрочной остановки.

Невыполнение заданной управляющей команды $s_j$ в течении заданного времени $t_{\mbox{max}}$,
подсистемы СПО АНПА считается аварийным.

Выдача определенного слова должна происходить при выполнении конечного множества условий как с задержкой, так и без нее.


\subsubsection{Имитация внутренних параметров АНПА}\label{sec:model_anpa:inner_params}
\textbf{Напряжение от АКБ.}
Информация о напряжениях $j$ \textit{модулях питания} АКБ $U_i = \{U_1, U_2, \ldots, U_j\}$ представляется вещественным числом,
для каждого модуля определяется допустимый диапазон напряжений $U_i \in [U_i^{min}, U_i^{max}]$,
выход за пределы которого считается аварийным и функционирование АНПА не допускается.

\textbf{Ток потребления абонентами АНПА.}
Суммарный ток потребления в имитационной модели определяется как $I_\Sigma = \sum_k^N I_k + \hat I$,
где $I_k$ токи контролируемых $N$ узлов системы, а $\hat I$ --- ток узлов не подлежащих контролю (не описанные в модели или флуктуации),
являются аналоговыми реакциями. % $A^r_{out}$.

Допустимый диапазон изменений токов $k$-го узла $I_k \in [I_k^{min}, I_k^{max}]$ обусловлен электрической схемой бортовой сети АНПА.
Аналогично $\hat I \in [\hat I^{min}, \hat I^{max}]$ находится в неком диапазоне.
Следовательно суммарный ток потребления АНПА также имеет некое распределение $I_\Sigma \in [I_\Sigma^{min}, I_\Sigma^{max}]$.
Выход одного параметров из допустимого диапазона $I_\Sigma, I_k, \hat I$ считается аварийным режимом работы АНПА.

Выдача определенного напряжения и тока должны происходить при выполнении определенных условий,
например, таких как инициализация некой заданной программы работы АНПА, которая
отождествляется с набором управляющих воздействий и ответных реакций на них.
Также значение $I_\Sigma$ может меняться в процессе проверки, для модулирования включения или выключений узлов,
то есть в общем случае может быть набор $I_\Sigma^{\langle k \rangle}$ для $k$-го состояния АНПА.
Таким образом, достаточно следить за конечным набором параметров и
имитировать напряжения и токи моментально или с некой задержкой $\tau$.

\textbf{Работа СУД.}
Согласно выбранной программе проверки на СК вырабатывается соответствующая 
частота $f$ вращения вала \textit{двигателя} в виде ШИМ сигнала.
Из АНПА возвращается периодический сигнал о прохождении определенной дистанции (метка кратного прохождения $m$ метров).
Выход периода $T \in [T^{min}, T^{max}]$ или скважности $Q \in [Q^{min}, Q^{max}]$ из допустимых диапазонов
СК рассматривается как аварийный режим.

ПУ обменивается целочисленными управляющими командами в формате запрос-ответ с СУД по шине данных, в частности с БУД,
для установки необходимого режима работы \textit{двигателя}.

Таким образом необходимо имитировать вращение валов винтов с выработкой прямоугольного сигнала заданного периода $T$ и скважностью $Q$,
аналогично -- генерации метки прохождения кратной дистанции
(увеличение контролируемого параметра на заданную величину $\delta \in \mathcal{R}$ с периодичностью $T_m$ в течении времени $\tau$).

\textbf{Работа рулевой системы.}
ПУ устанавливает заданные курс и глубину в следствии чего подсистема РП
осуществляет перекладку рулей средствами \textit{рулевых машинок}.
Информация с РМ может быть получена различными способами, в зависимости от их конструктивного исполнения.
Это может быть напряжение с потенциометров обратной связи, которое обрабатывается в БГР системы контроля
и передается в виде преобразованного цифрового сигнала
либо это может быть изначально  цифровой сигнал.

При проектировании АНПА устанавливается соответствие между $\langle s_j, \{r_j\} \rangle \Rightarrow \omega_i = \omega_i(s_j, \{r_j\}), i\in [1..N]$,
где $\omega_i$ -- заданные перекладки рулей для $N$ рулевых машинок,
$s_j, r_j$ -- управляющие и ответные последовательности.
Если на воздействие $s_j$ приходит ответ $r_{ji} \in \{r_j\}$, в котором содержится информация о том что,
поисковая цель находится по курсу $\bar \omega$, то должны быть установлены соответствующие значения перекладок рулей,
которые приведут к изменению курса и глубины для оптимального достижения поисковой цели.



\subsection{Онтология предметной области АНПА}

Перед созданием программной модели какого бы то ни было объекта, необходимо его описать,
то есть привести описание того, сколько свойств будут иметь объекты этого класса,
каких типов они должны быть, какой у них возможен диапазон значений и так далее.
То есть спецификация класса представляет собой \underline{метаданные} программных объектов \cite{journal:vestnik_spbgu:ivakin}.
Перейдем к построению и анализу онтологии предметной области АНПА.
Для построения онтологии используется программное обеспечение
\protege\footnote{\url{https://protege.stanford.edu/}}.

В листинге \ref{lst:model_anpa_owl} приложения \ref{app:sec:anpa_owl} показана
классификация сущностей.
%
Однако RDF не предоставляет никакого механизма для описания классов сущностей и
отношений. Эту задачу выполняют словари –- наборы предикатов, которые могут
использоваться в том или ином приложении, или онтологии, которые определяют не только
сами предикаты, но и типы данных для каждого предиката, а также отношения между
предикатами определенной области.

Все сущности (\textbf{объекты} из таблицы \ref{tbl:model_anpa_decompose}), имеющие отношение к АНПА, происходят из класса \texttt{АНПА},
который в свою очередь происходит из родительского суперкласса \texttt{owl:Thing},
от которого происходит наследование всех сущностей в онтологии.
Это кажется противоречивым с точки зрения парадигмы объектно-ориентированного программирования,
тем не менее так принято при построении онтологий, так как в будущем эта онтология может быть объединена с другой
и для предупреждения конфликта имен это сделано, так как каждая сущность описывается своим \textbf{IRI}
(здесь, \texttt{http://www.semanticweb.org/guap/ontologies/z8430m/ANPA\#АНПА}) \cite[раздел 2.1]{journal:vestnik_vgtu:shapkin}\footnote{%
<<Стиль должен быть точным, полным и очень подробным. Пользователь часто обращается к отдельному определению,
    поэтому во всех из них должны быть повторены все существенные элементы, и все они должны быть согласованы друг с другом.
    По этой причине инструкции часто скучно читать, но точность имеет приоритет перед увлекательностью>> \cite[гл.~6]{book:bruks:myth_mount_man}.
}.

В отличие от материальной декомпозиции на составляющие (например, СПО состоит из \textit{излучателя} и \textit{приемника}),
при декомпозиции модели эти сущности будут так называемыми \textit{индивидуальностями} класса \texttt{СПО},
а взаимоотношения между индивидуальностями определяется словарем.
Таксономия создаваемой онтологии классов модели АНПА показана на рисунке \ref{fig:common_classs_hierarchy}.

\subsubsection{Онтология объект-функция-действие}
Как было оговорено в таблице \ref{tbl:model_anpa_decompose}, композиция классов представляется в виде графа наследования,
как показано на рисунке \ref{fig:anpa_hierarchy}. Здесь осуществляется перенос выделенных элементов из раздела \ref{sec:anpa_decompose}.

\textbf{Свойства объектов.}
Для подклассов класса \texttt{АНПА} определяются свойства объектов (object properties), которые показаны в таблице \ref{tbl:anpa_object_properties}
(характеристика \textit{функционально} означает, что для любого данного индивида свойство может иметь не более одного значения. 
Другими словами, для этого индивида может существовать самое большое одно внешнее отношение вдоль собственности для свойства объекта).
%
\input{Dissertation/anpa_object_properties}
Рисунок \ref{fig:part_of} наглядно демонстрирует вхождения сущностей материального мира друг в друга и правила их электрического питания.
На этом рисунке применены следующие соглашения, что экземпляры (индивидуальности) классов начинаются со строчной буквы (д, рп, пу и так далее),
а сами классы --- с прописной (\texttt{АНПА}).

На рисунке \ref{fig:function_movement} показана взаимосвязь сущностей для реализации движения и наведения.
Очевидно, что изменение, например, текущей глубины $h$ через \texttt{заглубиться} -- экземпляр класса \texttt{Управление\_Наведение},
происходит с участием ПУ через триплет <<заглубиться -- Функционал\_Наведение -- пу>>.
А это в свою очередь связано с работой СПО через экземпляры \textit{излучатель}, \textit{приемник} и \textit{анализатор}.

Как видно из представленных рисунков и таблицы даже для относительно небольшой модели системы АНПА количество взаимосвязей между узлами
крайне велико и использование экспертных систем, в частности, \protege помогает выявлять эти связи,
а применение свойств объектов или свойств типов помогает выявить ошибки в несоответствии типов на ранних этапах проектирования модели (онтологии)
предметной области. Использование возможностей экспертной системы будет продемонстрировано в следующем разделе.


\begin{center}
    \begin{figure}[hb!]
        \begin{tikzpicture}[scale=.6,transform shape]
            \tikzstyle{VertexStyle}=[ellipse,draw=black, line width=1,font=\bfseries]
            \tikzstyle{LabelStyle}=[font=\bfseries,fill=gray!20,sloped,rectangle, rounded corners, draw]
            \tikzstyle{EdgeStyle}=[->,line width=1.5,fill=black]
            %
            \Vertex[x=0,y=0,L=owl:Thing]{thing}
            \Vertex[x=-5,y=-2,L=ModbusElement]{me}
            \Vertex[x=5,y=-2,L=АНПА]{anpa}
            %
            \Edge(thing)(me)
            \Edge(thing)(anpa)
        \end{tikzpicture}
        \caption[Иерархия классов в модели АНПА.]
            {Иерархия классов в модели АНПА. Смотри также рисунки \ref{fig:anpa_hierarchy} и \ref{fig:modbus_hierarchy}.}\label{fig:common_classs_hierarchy}
        %
        \includegraphics[width=.88\textwidth,keepaspectratio]{owl/anpa_hierarchy.png}
        \caption{Иерархия сущностей модели АНПА.}\label{fig:anpa_hierarchy}
        %
        \includegraphics[width=.88\textwidth,keepaspectratio]{owl/part_of.png}
        \caption[Граф свойств объектов]
            {Граф свойств объектов модели АНПА <<являться частью>> и  <<питание>>,
                определенных в таблице \ref{tbl:anpa_object_properties}.}\label{fig:part_of}
        %
        \includegraphics[width=.88\textwidth,keepaspectratio]{owl/function_movement.png}
        \caption[Граф взаимосвязи органов управления]%
            {Граф взаимосвязи органов управления и принятия решений на основе свойств классов модели АНПА касательно движения и наведения,
                определенных в таблице \ref{tbl:anpa_object_properties}.}\label{fig:function_movement}
    \end{figure}
\end{center}



\subsubsection{Онтология элементов имитатора сети Modbus}\label{sec:ontology_modbus}

На рисунке \ref{fig:modbus_hierarchy} представлена иерархия классов протокола Modbus,
у которой \mbelement является корневым элементом -- метакласс (см. таблицу~\ref{tbl:meta_data_levels}).
Этот класс хранит мета-информацию о
\begin{enumerate*}[label=\arabic*\upshape)]
    \item названии, 
    \item мета-типе передаваемого значения,
    \item правах доступа (чтение или запись),
    \item мета-адресе (адресное пространство имеет ячеистую структуру),
    \item назначении экземпляра класса,
\end{enumerate*}
что показано в таблице \ref{tbl:modbus_data_properties}.
%

\begin{table}[h]
    \begin{center}
    \caption[Свойства данных метаклассов]
        {Свойства данных (data properties) метаклассов \mbelement, \mbdata и пользовательские типы в программе \protege.}
            \label{tbl:modbus_data_properties}
    \begin{tabular}{|l|m{.6\textwidth}|}
    %
    \hline
    \textbf{Наименование} & \textbf{Тип} \\\hline
    %
    \multicolumn{2}{|c|}{\textit{Свойства}}\\\hline
    %
    \texttt{title} & \texttt{xsd:string} \\\hline
    \texttt{address} & \texttt{modbus:address} \\\hline
    \texttt{register} & \texttt{modbus:register} \\\hline
    \texttt{type} & \texttt{modbus:TransmitedType} \\\hline
    %
    \texttt{position} & \texttt{xsd:string} \\\hline
    \texttt{description} & \texttt{xsd:string} \\\hline
    %
    \texttt{value} & \texttt{xsd:anyURI} \\\hline
    %
    \multicolumn{2}{|c|}{\textit{Типы данных}}\\\hline
    %
    \texttt{modbus:address} & xsd:short[$>$ <<0>>\rdfwedge xsd:short, \\
                            & \hspace{15mm}$<=$ <<9999>>\rdfwedge xsd:short] \\\hline
    \texttt{modbus:register} & \{<<Coil>>, <<DiscreteInputs>>, \\
                             & \hspace{15mm}<<HoldingRegisters>>, <<InputRegisters>>\} \\\hline
    \texttt{modbus:TransmitedType} & \{<<Bool>>, <<DoubleWord>>, <<LongReal>>, \\
                                   & \hspace{15mm}<<Real>>, <<Word>>\} \\\hline
    \texttt{mobdus:Relation} & \{<<Eq>>, <<Ge>>, <<Gt>>, <<Le>>, <<Lt>>, <<Ne>>\} \\\hline
    %
\end{tabular}
\end{center}
\end{table}

\mbdata представляет хранилище для мета-данных для \mbelement, тип которых определяется на этапе инстацирования экземпляров класса,
    в том числе этот метакласс храни информацию о единицах измерений (вольты, амперы, секунды и так далее) и десятичных приставках (мили-, деци-, санти-, кило- и тому подобное)
    хранимой метрической величины.
На тип данных адреса накладывается ограничение на значение, согласно спецификации протокола Modbus.
%
\texttt{ModbusDataRelationed} определяет уровень метакласса и аксиомы отношений между метаклассами \mbdata
    (отношения $\equiv \ne > < \ge \le$), которые индуцируют изменения значений индивидов класса \mbdata.
    Предположим что, индивид $\mathcal{V}$ метакласса \texttt{ModbusDataRelationed}, связанный с определенным
    индивидом $\mathcal{M}_i$ метакласса \mbdata в момент создания имеет значение $v_0$ и одну из логических операций из множества $r \in \{\equiv,\ne,>,<,\ge,\le\}$,
    то для той же связанной переменной $\mathcal{M}_i$ в произвольный момент времени проверяется аксиома вида 
    \begin{equation}\label{eq:axiom_modbusdatarelationed}
        \begin{split}
            \mathcal{A}&\left(\mathcal{V}(\mathcal{M}_i)|_{t=0}\Rightarrow v_0, \mathcal{V}(\mathcal{M}_i)|_{v(t)};\, r\right) = a\,, {}\\
            a& \in \{0, 1\}\,.
        \end{split}
    \end{equation}
%
\texttt{ModbusElementWriter} метакласс, который формирует правила изменений значений переменных на шине данных Modbus,
    через своих наследников.

Классы \texttt{Guarded}, \texttt{MultiGuarded}, \texttt{DelayedGuarded}, \texttt{DelayedMultiGuarded}, \texttt{Periodic}
определяются с помощью логических правил средств RDF, как показано в таблице \ref{tbl:modbuselement_writer_def}.

\input{Dissertation/modbus_object_properties}

Свойства, относящиеся к домену метакласса \texttt{ModbusElementWriter}, упомянутые в таблице \ref{tbl:modbuselement_writer_def},
которые применяются к индивидам \texttt{ModbusElementWriter} после выполнения условий аксиомы выражения \eqref{eq:axiom_modbusdatarelationed}:
\begin{enumerate*}[label=\arabic*\upshape)]
    \item delay характеризует временную задержку на изменение значения отслеживаемого параметра;
    \item delta величина $\delta \in \mathcal{R}$, на которую меняется отслеживаемый параметр;
    \item duration продолжительность времени, в течении которого будет происходить изменение отслеживаемого параметра на величину $\delta$;
    \item period периодичность событий изменений отслеживаемого параметра.
\end{enumerate*}

Применение такого подхода, когда в программе \protege создаются индивиды метакласса \texttt{ModbusElementWriter},
с комбинацией вышеперечисленных свойств в полях data properties, позволяет при использовании элементов программного обеспечения экспертной системы,
в частности семантического механизма формирования рассуждений, который позволяет выводить логические умозаключения из набора формализованных базовых
знаний или аксиом\footnote{Semantic reasoner}, получать новые знания о фактическом классе индивида.
Эти правила вывода показаны условным знаком $\sim$ на рисунке \ref{fig:modbus_hierarchy}.
Иллюстрируя этот пример, выполнив \textbf{SPARQL} запрос для поиска всех причин изменения значений параметров,
имеющих величину задержки перед изменением более 100~условных единиц времени
\begin{lstlisting}[%
    language=sparql,%
    caption=Пример SPARQL запроса.,
    label=lst:sparql%
]
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX anpa:<http://www.semanticweb.org/guap/ontologies/z8430m/ANPA#>

SELECT ?volt ?condition ?delay ?newvalue 
       ?relation ?condvalue ?title
WHERE {
    ?volt anpa:ИмеетУсловие ?condition .
    ?volt anpa:value ?newvalue .
    ?condition anpa:relation ?relation .
    ?condition anpa:title ?title .
    ?condition anpa:value ?condvalue .
    ?volt anpa:delay ?delay . FILTER (?delay > 100) .
}
\end{lstlisting}
получим, что запросу из листинга \ref{lst:sparql} соответствует только лишь элемент, показанный в таблице \ref{tbl:sparql_result}:
\begin{table}[ht!]
\begin{center}
    \caption[Результат SPARQL запроса]{Результат SPARQL запроса из листинга \ref{lst:sparql}.}\label{tbl:sparql_result}
    \begin{tabular}{|c|l|}\hline
        volt & Uv\_пу \\\hline
        condition & C1 \\\hline
        delay & <<500>>\rdfwedge<http://www.w3.org/2001/XMLSchema\#unsignedLong> \\\hline
        newvalue & <<27>>\rdfwedge<http://www.w3.org/2001/XMLSchema\#anyURI> \\\hline
        relation & {\small<<Eq>>\rdfwedge<http://www.semanticweb.org/guap/ontologies/z8430m/ANPA\#relation>} \\\hline
        condvalue & <<true>>\rdfwedge<http://www.w3.org/2001/XMLSchema\#anyURI> \\\hline
        title & <<C1>>\rdfwedge<http://www.w3.org/2001/XMLSchema\#string> \\\hline
    \end{tabular}
\end{center}
\end{table}
причем изменение произойдет через 500~мс и будет присвоено значение 27~В, после того как значение переменной,
ассоциированной с тегом \texttt{C1} примет значение логической единицы.

\begin{center}
    \begin{figure}[ht]
        \begin{tikzpicture}[scale=.75,transform shape]
            \tikzstyle{VertexStyle}=[font=\bfseries]
            \tikzstyle{LabelStyle}=[font=\bfseries,fill=gray!20,sloped,rectangle, rounded corners, draw]
            %
            \Vertex[x=0,y=0,L=owl:Thing]{thing}
            \SO[L=ModbusElement](thing){me}
            \SO[L=ModbusData](me){md}
            \Vertex[x=-5,y=-8,L=ModbusDataRelationed]{rel}
            \Vertex[x=5,y=-8,L=ModbusElementWriter]{w}
            \Vertex[x=-2,y=-11,L=Guarded]{g}
            \Vertex[x=7,y=-11,L=MultiGuarded]{mg}
            \Vertex[x=-2,y=-14,L=DelayedGuarded]{dg}
            \Vertex[x=5,y=-14,L=Periodic]{p}
            \Vertex[x=10,y=-14,L=DelayedMultiGuarded]{dmg}
            %
            % Прямые ребра
            \tikzstyle{EdgeStyle}=[->]
            \Edge(thing)(me)
            \Edge(me)(md)
            \Edge[label=$\sim$](g)(dg)
            % Гнутые ребра
            \tikzstyle{EdgeStyle}=[->, bend right]
            \Edge[label=метакласс](md)(rel)
            \Edge[label=$\sim$](w)(g)
            \Edge[label=$\sim$](mg)(p)
            %
            \tikzstyle{EdgeStyle}=[->, bend left]
            \Edge[label=метакласс](md)(w)
            \Edge[label=$\sim$](w)(mg)
            \Edge[label=$\sim$](mg)(dmg)
            %
            \tikzstyle{EdgeStyle}=[-,draw=gray!25,decorate,decoration={coil}]
            \Edge[label=$n\equiv1$](rel)(g)
            \Edge[label=$n>1$](rel)(mg)
        \end{tikzpicture}
        \caption{Иерархия элементов имитатора.}\label{fig:modbus_hierarchy}
    \end{figure}
\end{center}
    

% Таким образом становится возможным определить эквивалентность для вышеперечисленных классов, как показано в листинге ниже \ref{lst:owl_modbus_equivalent_to}.


\subsection*{Заключение}
Принимая во внимание результаты анализа взаимосвязей составных частей АНПА на функциональном уровне,
имитационная модель АНПА строится на основе следующих компонентов:
\begin{enumerate*}[label=\arabic*\upshape)]
    \item непосредственная запись значения при выполнении единичного условия;
    \item отложенная запись значения при выполнении единичного условия;
    \item непосредственная запись значения при выполнении множественных условий;
    \item отложенная запись значения при выполнении множественных условий;
    \item периодическое изменение на заданную величину в течении определенного времени.
\end{enumerate*}

В АНПА в общем случае может быть множество шин данных, по которым происходит обмен между СЧ АНПА и системой контроля.
СК в свою очередь так же может использовать набор протоколов для обмена информацией с АНПА
или для обработки первичного набора сигналов от АНПА.
Одним из таких интерфейсов является Modbus, так как после прохождения первичных сигналов через БГР
они поступают на ПЛК, который взаимодействует с ПО верхнего уровня, например, по протоколу Modbus~TCP/IP.
Далее будет показана модель \textit{решающая} задачу имитации взаимодействия СК с АНПА.
